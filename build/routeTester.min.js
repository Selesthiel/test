/*! routeTester 2014-05-12 */
!function(a){"use strict";var b,c,d="http://10.178.18.145:1337",e=function(a){var b,c="";if(void 0!==a)for(b in a)a.hasOwnProperty(b)&&(c=""===c?"?":c+"&&",c=c+b+"="+encodeURIComponent(JSON.stringify(a[b])));return c},f=function(a,b){var c,f,g=new XMLHttpRequest,h=a.path||"",i=void 0!==a.body?JSON.stringify(a.body):"";f=e(a.query),c=d+h+f,g.onreadystatechange=function(){4===g.readyState&&b(200===g.status?JSON.parse(g.responseText):void 0)},g.open("POST",c,!0),g.setRequestHeader("Content-type","application/x-www-form-urlencoded"),g.send(i)};a.request=f,a.approve=function(a,d){var e={};e.path="/approve/"+encodeURIComponent(a),e.query={dapiAuthToken:b},f(e,function(a){void 0===a||"error"===a.status&&void 0!==a.approvalToken?d(void 0):(c=a.dapiApprovalToken,d(c))})},a.setApprovalToken=function(a){return c=a,this},a.authenticate=function(a,c,d){var e={};e.path="/auth",e.query={clientID:a,clientSecret:c},d="function"==typeof d?d:function(){},f(e,function(a){void 0===a||"error"===a.status&&void 0!==a.approvalToken?d(void 0):(b=a.dapiAuthToken,d(b))})},a.addClient=function(a,c){var d={};d.path="/client/add",d.query={dapiAuthToken:b,productID:a.productID,clientID:a.clientID},f(d,function(a){c(a.clientSecret)})},a.addGrant=function(a,c,d,e){var g={};g.path="/grant/add",g.query={dapiAuthToken:b,licenseID:a,userID:c,productID:d},f(g,function(a){void 0!==e&&e(a)})},a.addLicense=function(a,c,d,e){var g={};g.path="/license/add",g.query={dapiAuthToken:b,organizationID:a,productID:c,expiryDate:d},f(g,function(a){void 0!==e&&e(a)})},a.addProduct=function(a,c){var d={};d.path="/product/add",d.query={dapiAuthToken:b,productName:a},f(d,function(a){void 0!==c&&c(a)})},a.addUser=function(a,c,d){var e={};e.path="/user/add",e.query={dapiAuthToken:b,userName:a,openIdIdentity:c},f(e,function(a){void 0!==d&&d(a)})},a.listClients=function(a){var c={};c.path="/client/list",c.query={dapiAuthToken:b},f(c,a)},a.listExports=function(a){var c={};c.path="/stat/exports",c.query={dapiAuthToken:b},f(c,a)},a.listGrants=function(a){var c={};c.path="/grant/list",c.query={dapiAuthToken:b},f(c,a)},a.listLicenses=function(a){var c={};c.path="/license/list",c.query={dapiAuthToken:b},f(c,a)},a.listProducts=function(a){var c={};c.path="/product/list",c.query={dapiAuthToken:b},f(c,a)},a.listRoutes=function(a){var c={};c.path="/stat/routes",c.query={dapiAuthToken:b},f(c,a)},a.listUsers=function(a){var c={};c.path="/user/list",c.query={dapiAuthToken:b},f(c,a)},a.getServerLogs=function(a){var c={};c.path="/logs/all",c.query={dapiAuthToken:b},f(c,function(b){var c=b;a(c.rawLogs)})},a.getUptime=function(a){var c={};c.path="/stat/uptime",c.query={dapiAuthToken:b},f(c,function(b){var c=b;a(c.uptime)})},a.isValidAuthToken=function(a,c){var d,e=!1;if("function"==typeof a&&(c=a,a=b),d={path:"/auth/isValid",query:{dapiAuthToken:a}},void 0===a||""===a)e=!1,c(e);else{var g=function(a){var b=JSON.parse(a);e="1"===b.isValidAuthToken,c(e)};f(d,g)}},a.testConnection=function(a){var b={command:"this_will_fail"},c=function(b){var c=b;a(void 0!==c.status?!0:!1)};f(b,c)},a.getLoginUrl=function(a){var c={};c.path="/openid/geturl",c.query={dapiAuthToken:b},f(c,function(b){var c=b;a(c.redirectURL)})},a.loginResponse=function(c){var d={};return d.path="/openid/loginResponse",d.query={dapiAuthToken:b},f(d,function(b){var d;void 0===b?a.loginResponse(c):(d=b,c(d.openidInfo))}),this}}(window.jsdapi=window.jsdapi||{}),function(a){"use strict";var b,c,d="routeTesterID",e="NQ754XXNT5HWS42KHB30W625BRTPQX0MDRJMNTZ7",f=function(){return new Promise(function(c){var d={};d.path="/product/add",d.query={dapiAuthToken:b,productName:"testProduct"};jsdapi.request(d,function(b){console.log(b);var e="<div class='testTitle'>Add Product</div>";e=e+"<div class='route'>"+d.path+"</div>",e=e+"<div class='params'>Params:"+m(d.query)+"</div>",e+=b.success===!0?"<div class='pass'>Passed</div>":"<div class='fail'>Fail</div>",a.postResults(e),c(e)})})},g=function(){return new Promise(function(c){var d={};d.path="/product/list",d.query={dapiAuthToken:b},jsdapi.request(d,function(b){var e="<div class='testTitle'>List Product</div>";e=e+"<div class='route'>"+d.path+"</div>",e=e+"<div class='params'>Params:<br>"+m(d.query)+"</div>",e+=void 0!==b&&b.length>0?"<div class='pass'>Passed</div>":"<div class='fail'>Fail</div>",a.postResults(e),c(e)})})},h=function(){return new Promise(function(c){var d={};d.path="/user/list",d.query={dapiAuthToken:b},jsdapi.request(d,function(b){var e="<div class='testTitle'>List Users</div>";e=e+"<div class='route'>"+d.path+"</div>",e=e+"<div class='params'>Params:<br>"+m(d.query)+"</div>",e+=void 0!==b&&b.length>0?"<div class='pass'>Passed</div>":"<div class='fail'>Failed</div>",e+=m(b),a.postResults(e),c(e)})})},i=function(){return new Promise(function(c){var d={};d.path="/approve/1234",d.query={dapiAuthToken:b},jsdapi.request(d,function(b){var e="<div class='testTitle'>Approval</div>";e=e+"<div class='route'>"+d.path+"</div>",e=e+"<div class='params'>Params:<br>"+m(d.query)+"</div>",console.log(b),e+=void 0!==b&&"no grant for user/product"===b.error?"<div class='pass'>Passed</div>":"<div class='fail'>Failed</div>",a.postResults(e),c(e)})})},j=function(){return k().then(function(){return l(g)}).then(function(){return l(f,1)}).then(function(){return l(h,1)}).then(function(){return l(i,1)}),this},k=function(){return new Promise(function(a){void 0===b?jsdapi.authenticate(d,e,function(c){b=c,a()}):a()})},l=function(a,b){return b=b||1,new Promise(function(c){a().then(function(){b--,0>=b?c():l(a,b).then(c)})})},m=function(a){return JSON.stringify(a,null,4).replace(/\n/g,"<br>").replace(/\s/g,"&nbsp;")};a.postResults=function(a){return"string"!=typeof a&&(a=JSON.stringify(a,null,4).replace(/\n/g,"<br>").replace(/\s/g,"&nbsp;")),c.innerHTML=c.innerHTML+"<hr>"+a,this},a.startTest=function(a){return c=document.getElementById(a),c.innerHTML="",j(),this}}(window.routeTest=window.routeTest||{});